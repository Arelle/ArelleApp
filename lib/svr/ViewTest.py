'''
Created on Jan 13, 2015

@author: Mark V Systems Limited
(c) Copyright 2015 Mark V Systems Limited, All rights reserved.
'''
from XbrlSemanticDB import XbrlSemanticDatabaseConnection

def viewTest(request):
    dbConn = XbrlSemanticDatabaseConnection(request)
    _testCase = dbConn.request.query.testId
    if (_testCase == "test_multivariate_COST2014sample"):
        results = dbConn.execute("Test " + _testCase, """
            SELECT f.filing_id, (e.name || ' - ' || f.filing_number || ' - ' || f.accepted_timestamp) , e.reference_number,
                            (SELECT SUM(d.effective_value) 
                            FROM _fsbm_to_ugt f2u, aspect a, data_point d
                            WHERE d.report_id = r.report_id
                                AND d.context_xml_id = dc.context_xml_id -- default context
                                AND f2u.cname = 'SALE'
                                AND a.aspect_id = d.aspect_id
                                AND a.name = f2u.uname)
                    FROM entity e, filing f, report r, data_point dc, aspect ac
                    WHERE e.reference_number::integer in (2034, 2969, 98618, 3545, 4127, 771497, 5094, 6281, 6284, 320193, 6951, 6955, 352991, 1305014, 8411, 8670, 8858, 14846, 320174, 109563, 10795, 720762, 13573, 746598, 14195, 16040, 16058, 16732, 721371, 17843, 19446, 703351, 21076, 21510, 830524, 1179484, 22444, 23197, 718332, 93859, 25212, 1067294, 26076, 351231, 315189, 277375, 730464, 28561, 1001039, 29644, 1498301, 67215, 720875, 30831, 350797, 32604, 350917, 731802, 316253, 33533, 33619, 764401, 34408, 34563, 37472, 355019, 38777, 39648, 40570, 202058, 46765, 47217, 47518, 357294, 772897, 49728, 722830, 50725, 93284, 51011, 808450, 353944, 316793, 52988, 53669, 319201, 55242, 719733, 55772, 56701, 56806, 56978, 763532, 357020, 1126956, 707549, 57515, 58361, 16099, 68709, 61398, 62362, 749038, 54187, 729284, 64472, 65011, 65312, 723125, 310568, 716688, 67625, 67887, 69422, 69633, 70145, 70793, 356309, 72331, 74046, 75829, 1534293, 76334, 1422862, 216877, 80420, 80424, 276720, 720500, 720005, 716643, 1069533, 1024478, 85535, 87565, 87802, 90168, 718924, 92679, 310354, 93676, 96021, 103096, 96699, 96793, 1376986, 730263, 737758, 732026, 100378, 1608109, 100493, 884614, 100726, 717954, 102741, 203527, 103595, 105132, 104207, 1103601, 104897, 106040, 107687, 108312, 109177, 1083743, 725876, 775158, 739608, 779152, 1517681, 1527675, 1547459, 878726, 775057, 789019, 1024305, 791907, 785557, 754811, 794172, 788920, 796505, 796343, 773318, 1166220, 800459, 803647, 728387, 785956, 805305, 1308161, 844059, 785786, 50493, 801898, 807882, 809933, 799694, 810136, 803016, 811809, 812128, 826326, 787253, 811212, 814547, 788329, 922358, 1358651, 722572, 807863, 814904, 743316, 1546640, 820318, 9521, 793040, 790500, 32598, 779336, 809708, 809844, 804123, 38188, 805267, 830160, 748691, 811922, 826735, 809173, 801961, 65433, 830271, 812801, 818850, 833251, 810943, 830622, 828803, 818972, 833029, 827773, 1506488, 836157, 836809, 839122, 835948, 102426, 832327, 839533, 719245, 845606, 833021, 847411, 833040, 842905, 846596, 830487, 844790, 838131, 836937, 842023, 849998, 1177648, 818851, 853770, 851169, 851170, 811831, 854775, 855654, 856128, 856226, 936528, 852564, 855887, 1547521, 1557798, 1564709, 1416090, 1118417, 1509261, 1556801, 843212, 1557644, 1564708, 1567892,  0, 1557523,  0, 1577791, 1574460, 1526689, 1577916, 1585064, 835403, 857005, 856218, 1572280, 1591588, 1495850, 1587755, 875582, 1135644, 1590976, 315131, 855886, 825322, 1581378, 1591698, 1578348, 1583771, 827871, 1594337, 1273636, 857361, 1069899, 825542, 1596783, 1378564, 1472847, 1603429, 1606757, 1603969, 858877, 859737, 860489, 858707, 857949, 1608249, 1613665, 860188, 1609702, 858803, 924383, 862716, 57725, 1097718, 863894, 864415, 863900, 866273, 866706, 896156, 869405, 858655, 868578, 870778, 870780, 868611, 872064, 866787, 1404079, 874506, 874292, 876523, 878242, 878520, 878198, 878200, 878201, 879796, 877463, 879535, 880117, 1585364, 831641, 879361, 804328, 880446, 880845, 874710, 867840, 880943, 880432, 865436, 882071, 880892, 883241, 876717, 849146, 882152, 882153, 882151, 882150, 883902, 881790, 1433966, 883412, 884121, 885074, 883265, 884216, 792130, 884152, 886206, 882184, 875729, 885307, 829224, 845379, 887733, 860518, 890196, 887590, 885734, 866095, 887226, 862668, 887394, 888295, 851726, 865277, 891037, 888410, 891188, 890393, 891038, 892992, 885125, 895419, 895422, 894242, 885601, 896061, 896878, 896985, 896923, 897269, 897723, 898293, 895531, 895528, 902748, 906193, 1618673, 879407, 86759, 907471, 909954, 909112, 897996, 908993, 909832, 911638, 911216, 911308, 912603, 910068, 912093, 912729, 912023, 910679, 722392, 913662, 914035, 100548, 910406, 865941, 914712, 916314, 915840, 230498, 1470215, 900075, 918965, 916907, 919708, 880406, 923120, 63296, 1445942, 929940, 929887, 932793, 925683, 915862, 933974, 854701, 913760, 933034, 1140859, 933267, 943819, 1383875, 928465, 946453, 899923, 935419, 1001250, 1003344, 799729, 1002037, 1002517, 865415, 1003078, 1002590, 95052, 1001907, 932628, 1002638, 1016504, 896400, 896429, 889971, 38264, 1005731, 1005210, 1006177, 1006655, 882873, 1013237, 1010470, 1009242, 937136, 1006028, 1019361, 945828, 880059, 1020859, 812011, 936395, 889930, 1173431, 808326, 1028215, 1032220, 1023459, 1041803, 1113256, 1038186, 1487730, 1045126, 1041514, 1039065, 1001426, 1038541, 1035354, 1001115, 1046050, 1041130, 1048268, 924095, 1049521, 1050007, 1038190, 924717, 1041177, 1051004, 1063665, 869428, 314590, 1139313, 1169715, 1023514, 1072483, 875809, 1171264, 744452, 1077800, 1059784, 1018281, 890543, 936958, 1039280, 1053988, 884394, 1029744, 1057060, 1061894, 1006830, 1059272, 1062579, 1059213, 1059386, 1062978, 898770, 1061353, 1070732, 50471, 1068963, 1001279, 1066026, 1064641, 1070524, 1075880, 1070154, 1074688, 1074690, 1074692, 1074686, 1074687, 1074691, 1074685, 1074540, 1073349, 1071899, 1490906, 1074543, 1078271, 1009626, 1083839, 1074952, 1074769, 1048695, 1082506, 1068874, 1099369, 1071840, 1084869, 1066194, 1060426, 101462, 1093207, 1092367, 1092896, 1093428,  0, 0,  0, 0,  0, 0,  0, 0,  0, 1089143, 1342854,  0, 0,  0, 0,  0, 930667,  0, 0,  0, 1100949,  0, 0,  0, 0,  0, 0, 1090872, 1107457, 319156, 1096752, 1102934, 1101146, 1110647, 758938, 823277,  0, 836690,  0, 1116284, 1101396,  0, 0, 1114925, 1116521, 1022225,  0, 1622620,  0, 0,  0, 0,  0, 1116132,  0, 1110783, 1128173, 1100412, 1294632,  0, 817720, 1127706, 1087786, 1131063, 1131062, 1115463, 1467373,  0, 1137411,  0, 0,  0, 1137391, 1137393, 1137392, 1137440, 1137390, 1143513, 1137887, 1137888, 1478726,  0, 0, 1144215, 1160864, 1160990, 1142637, 1162028, 1162027, 1162030, 104819, 1090116, 1161070, 868857, 1260221, 1169034, 1169031, 1167467, 1169028, 1169029, 1167470, 1171471, 1157817, 1406194, 1176194, 1176197, 1145255, 1176199, 1176984, 1177162, 1177161, 1178840, 1178841, 1178839, 1137789,  0, 0, 1181187, 1181024, 1181026, 1181506, 1181504, 1181505, 1169717, 1195738, 1195739, 1195737, 1196867, 1196869, 1196871, 1196876, 1196872, 1196874, 1196875, 1196877, 1189740, 1187520, 1158780, 1202806, 1199004, 1190935, 1174164,  0, 1224480,  0, 1208211, 1219120, 1222401, 1222719, 1227073, 15357, 1233681, 1244183, 1235511, 1245648, 1262279, 1253327,  0, 1261654, 57183, 1259708, 1261166, 1266585, 1258623, 1227862, 1262104, 1412109, 1267890, 1270523, 52848, 830916, 1287032, 1276533, 1281926, 1279014, 1280936, 1375063, 1124941, 1284940, 1289213, 1379006, 1271046, 1617242, 1293613, 1293211,  0, 1296250, 1299393, 1300391, 1222333, 1308547, 1299709, 1306550, 1305767, 1305197, 1312073, 1302901, 1278460, 1316625, 1171155, 1310445, 1287498, 1297341, 1319161, 1314966, 1320947,  0, 857489, 1419465,  0, 0,  0, 1302084, 1317577, 1323974, 1319183, 1320375, 1262976, 1322652, 17485, 1332283, 1326390, 1357450, 1362180, 836429,  0, 0,  0, 0, 1285650,  0, 0,  0, 0,  0, 0,  0, 0, 1339947, 1328598, 1338460, 1334933, 832488, 1178104,  0, 0,  0, 1235468, 1343793, 1515003, 1350593, 1329388, 1301991, 1344970, 1342287, 1502966, 1527027, 1538263, 1223862, 1176309, 1530950, 1453099, 1409197, 1530425, 1327567, 1334699, 1014507,  0, 0,  0, 0,  0, 0, 1363438, 1341726, 1368458, 1309057, 1374783, 1483195, 1044577, 1375320, 1375365, 1377789, 1138723, 1355250, 1382230, 1383196, 1381668, 1173752, 1379438, 1383312, 1322505, 1388133, 1385508, 1383414, 1388141, 1385187, 1385157, 1390195, 1376793,  0, 0,  0, 1259542,  0, 1383496,  0, 0, 1324245, 1337905, 1391461, 1392363, 1362718, 1398797, 1400897, 1403275, 1396502, 1408287, 1413257, 1406243, 1413507, 1157408, 1380277, 1419139, 1180145, 1403161, 1408710, 1422768, 1417398, 1415744, 1423221, 1410253, 1422892, 1403676, 1414932, 1386301, 1438644, 1378992, 1424864, 1425808, 1420720, 1442620, 1407583, 1441634, 1434674, 1448301, 1444307, 1421538, 1391750, 1448806, 1457543, 1444837, 1409885, 1158420, 1474439, 1469372, 1477246, 1117297, 1099290, 1443242, 1387467, 1476765,  0, 1488917, 1485964, 1333822, 852437, 1490013, 1118974, 1501078, 1499506, 1471968, 1446152,  0, 1505823, 1502377, 1497165, 1490349, 1479526, 1497130, 1584509, 1504619, 1498122, 1504239, 1499274, 767884, 1497572, 1511737, 1514743, 1483496, 1378718, 1493594, 1501112, 1528396, 1497316, 1526329, 1549107, 1034957, 1023512, 1556884, 72444, 1046126, 943502, 1166272, 1131343, 1506184, 1314102, 1476170, 1263994, 1270131, 1268533, 1275214, 1140310, 1383571, 1463471, 1499849, 1343719, 1496371, 1492966) 
                AND f.entity_id = e.entity_id AND f.filing_id = r.filing_id
                AND f.form_type ilike '10-k' 
                AND f.filing_date::varchar like '2014%'
                    -- default context for duration periods
                    AND dc.report_id = r.report_id AND ac.aspect_id = dc.aspect_id AND ac.name = 'DocumentPeriodEndDate'
                    GROUP BY f.filing_id, e.reference_number, e.name, r.report_id, dc.context_xml_id
            """)
    else:
        results = []
    dbConn.close()
    return {"rows": [{"id": result[0], "data": [r if r is not None else '' 
                                                for r in result[1:]]}
                     for result in results]}
